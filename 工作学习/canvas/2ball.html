<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	
	<canvas id="canvas">
		你的浏览器不支持canvas,请更换后尝试,或者联系wo
	</canvas>
	<script type="text/javascript">

		//简单实现requestAnimFrame兼容性
		window.requestAnimFrame = (function(){
  		return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
		})();

	var can = document.getElementById("canvas");
	var ctx = can.getContext("2d");
	var balls = [];
	window.onload = init();
	function init(){
		can.width = 1200;
		can.height = 600;

		drawBalls();
		gameloop();
		

		
		





	}
	function gameloop(){
		window.requestAnimFrame(gameloop);
		
		drawBall();
		updateBalls();
		//distance();
		

	}

	

	function drawBalls(){
		

		for(var i = 0;i < 30 ;i++){
			
			var R = Math.floor(Math.random()*255);
			var G = Math.floor(Math.random()*255);
			var B = Math.floor(Math.random()*255);
			var radius = Math.random()*50 + 10;
			ball = {
				
			color:"rgb(" + R + "," + G + "," + B + ")",
			radius:radius,
			x:Math.random()*(can.width-2*radius) + radius,
			y:Math.random()*(can.height-2*radius) + radius,
			// vx: (Math.random()*5 + 1)*Math.pow(-1,Math.floor(Math.random()*1000)),
			// vy: (Math.random()*5 + 1)*Math.pow(-1,Math.floor(Math.random()*1000)),
			vx:Math.floor((Math.random()*10 + 1)),
			vy:Math.floor((Math.random()*10 + 1))
			};
			//balls.push(ball);
			balls[i]=ball;
			
		}
	}
	function drawBall(){
		ctx.clearRect(0,0,canvas.width,canvas.height);
		ctx.globalAlpha = 1;
		ctx.globalCompositeOperation="xor";
		for(var i=0;i<balls.length;i++){
			ctx.fillStyle = balls[i].color;
			ctx.beginPath();
			ctx.arc(balls[i].x,balls[i].y,balls[i].radius,0,Math.PI*2);
			ctx.closePath();
			ctx.fill();
		}
	}

	function dis(x1,y1,x2,y2){
		return Math.sqrt((x1 - x2)*(x1 - x2) + (y1 - y2)*(y1 - y2));
	}
	function mass(r){
		return 2*r*r;
	}

	function updateBalls(){
		for(var i = 0;i < balls.length;i++){
			balls[i].x += balls[i].vx;
			balls[i].y += balls[i].vy;
			if(balls[i].x - balls[i].radius <=0){
				balls[i].vx = -balls[i].vx;
				balls[i].x = balls[i].radius;
			}
			if(balls[i].x > can.width-balls[i].radius){
				balls[i].vx = -balls[i].vx;
				balls[i].x = can.width-balls[i].radius;
			}
			if(balls[i].y - balls[i].radius <=0){
				balls[i].vy = -balls[i].vy;
				balls[i].y = balls[i].radius;
			}
			if(balls[i].y > can.height - balls[i].radius){
				balls[i].vy = -balls[i].vy;
				balls[i].y = can.height - balls[i].radius;
			}

		

			
			for(var j = 1;j<balls.length - i;j++){


			var ddd=dis(balls[i].x,balls[i].y,balls[i + j].x,balls[i + j].y);
			console.log(ddd);
			var Rr = balls[i].radius + balls[i + j].radius;
			console.log(Rr);
			var cha = Rr - ddd;
			console.log(cha);
			if(cha>0){
				balls[i].x += -cha;
				balls[i].y += -cha;
				balls[i + j].x += cha;
				balls[i + j].y += cha;

				balls[i].vx= -balls[i].vx;
				balls[i].vy= -balls[i].vy;

				balls[i + j].vx= -balls[i + j].vx;
				balls[i + j].vy= -balls[i + j].vy;

			}
			// var mas = mass(balls[i].radius);

			// 	if(Rr>ddd){
			// 		var a;
			// 			if(Rr - ddd>2){
			// 				a=1;

			// 			}else{
			// 				a=0;
			// 			}
			// 			if(a=1){
			// 				balls[i + j].x+=10;
			// 				balls[i + j].y+=10;
			// 			}else{

			// 			balls[i].vx= -balls[i].vx;
			// 			balls[i].vy= -balls[i].vy;

			// 			balls[i + j].vx= -balls[i + j].vx;
			// 			balls[i + j].vy= -balls[i + j].vy;
			// 			}
			// 			// balls[i + j].x = balls[i + j].x + balls[i + j].radius + balls[i].radius;
			// 			// balls[i + j].y = balls[i + j].y + balls[i + j].radius + balls[i].radius;
						
						
			// }
			

				
				

			}
		

		
	
		}
			
			



		

	}

	function dis(x1,y1,x2,y2){
		return Math.sqrt((x1 - x2)*(x1 - x2) + (y1 - y2)*(y1 - y2));
	}
	// function distance(){
	// 	var ddd=dis(balls[0].x,balls[0].y,balls[1].x,balls[1].y);
	// 	//console.log(ddd);
	// 	var Rr = balls[0].radius + balls[1].radius;
	// 	//console.log(Rr);
	// 	if(ddd<Rr){


	// 	}

	// }
function pz(one,two){
			var x = two.x - one.x,
				y = two.y - one.y,
				l = Math.sqrt(x*x+y*y),
				angle,
				radian;
			if(one.radius+two.radius >= l){

				radian = Math.atan2(y,x);
				var sin = Math.sin(radian);
				var cos = Math.cos(radian);
				var pos0 = {x:0,y:0};
				
				var pos1 = balls[i].rotate(x,y,sin,cos,true);
				var vel0 = balls[i].rotate(one.vx,one.vy,sin,cos,true);
				var vel1 = balls[i].rotate(two.vx,two.vy,sin,cos,true);
				
				
				var vxTotal = vel0.x - vel1.x;
				vel0.x = ((one.mass - two.mass) * vel0.x + 2 * one.mass * vel1.x)/(one.mass+two.mass);
			
				vel1.x = vxTotal + vel0.x;
				var absV = Math.abs(vel0.x) + Math.abs(vel1.x);
				var overlap = (one.radius+two.radius) - Math.abs(pos0.x-pos1.x);
				
				pos0.x += vel0.x / absV * overlap;
				pos1.x += vel1.x / absV * overlap;
				var pos0f = balls[i].rotate(pos0.x,pos0.y,sin,cos,false);
				var pos1f = balls[i].rotate(pos1.x,pos1.y,sin,cos,false);
				two.x = one.x + pos1f.x;
				two.y = one.y + pos1f.y;
				one.x = one.x + pos0f.x;
				one.y = one.y + pos0f.y;

				var vel0f = balls[i].rotate(vel0.x,vel0.y,sin,cos,false);
				var vel1f = balls[i].rotate(vel1.x,vel1.y,sin,cos,false);
				one.vx = vel0f.x;
				one.vy = vel0f.y;
				two.vx = vel1f.x;
				two.vy = vel1f.y;
			}
		}

	// function pz(one,two){
	// 		var x = two.x - one.x,
	// 			y = two.y - one.y,
	// 			l = Math.sqrt(x*x+y*y),
	// 			angle,
	// 			Rr = one.radius+two.radius,
	// 			radian;
	// 			console.log(l);
	// 			console.log(Rr);
	// 			if(Rr >= l){

	// 			}

			// if(one.radius+two.radius >= l){

			// 	radian = Math.atan2(y,x);
			// 	var sin = Math.sin(radian);
			// 	var cos = Math.cos(radian);
			// 	var pos0 = {x:0,y:0};
				
			// 	var pos1 = this.rotate(x,y,sin,cos,true);
			// 	var vel0 = this.rotate(one.ax,one.ay,sin,cos,true);
			// 	var vel1 = this.rotate(two.ax,two.ay,sin,cos,true);
				
				
			// 	var vxTotal = vel0.x - vel1.x;
			// 	vel0.x = ((one.mass - two.mass) * vel0.x + 2 * one.mass * vel1.x)/(one.mass+two.mass);
			
			// 	vel1.x = vxTotal + vel0.x;
			// 	var absV = Math.abs(vel0.x) + Math.abs(vel1.x);
			// 	var overlap = (one.radius+two.radius) - Math.abs(pos0.x-pos1.x);
				
			// 	pos0.x += vel0.x / absV * overlap;
			// 	pos1.x += vel1.x / absV * overlap;
			// 	var pos0f = this.rotate(pos0.x,pos0.y,sin,cos,false);
			// 	var pos1f = this.rotate(pos1.x,pos1.y,sin,cos,false);
			// 	two.x = one.x + pos1f.x;
			// 	two.y = one.y + pos1f.y;
			// 	one.x = one.x + pos0f.x;
			// 	one.y = one.y + pos0f.y;

			// 	var vel0f = this.rotate(vel0.x,vel0.y,sin,cos,false);
			// 	var vel1f = this.rotate(vel1.x,vel1.y,sin,cos,false);
			// 	one.ax = vel0f.x;
			// 	one.ay = vel0f.y;
			// 	two.ax = vel1f.x;
			// 	two.ay = vel1f.y;
			// }
		// }

	</script>
</body>
</html>