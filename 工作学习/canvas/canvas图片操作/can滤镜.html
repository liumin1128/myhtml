<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
	#canvasa{
		display: inline-block;
	}
	#canvasb{
		display: inline-block;
	}
</style>
</head>

<body>
	<canvas id="canvasa"></canvas>
	<canvas id="canvasb"></canvas>
	<button onclick="filter()"></button>
	<script>
	var canvasa = document.getElementById("canvasa");
	var canvasb = document.getElementById("canvasb");
	var contexta = canvasa.getContext("2d");
	var contextb = canvasb.getContext("2d");
	var image = new Image();
	window.onload = function(){
		canvasa.width = 460;
		canvasa.height = 690;
		canvasb.width = 460;
		canvasb.height = 690;
		image.src = "img.jpg";
		image.onload = function(){
			contexta.drawImage(image,0,0,canvasa.width,canvasa.height);
			filter();
		}

	}
	function filter(){
		// alert();
		var imageData = contexta.getImageData(0,0,canvasa.width,canvasa.height);
		var pixelData = imageData.data;
		// greyEffect2(pixelData);
		// BlackOrWite(pixelData);
		// reverse(pixelData);
		greyEffect(pixelData);
		contextb.putImageData(imageData,0,0,50,50,canvasb.width-50,canvasb.height-100);//减去两倍
	}
	function greyEffect(pixelData){
		for(i = 0;i<canvasb.width*canvasb.height;i++){
			var r = pixelData[i*4+0];
			var g = pixelData[i*4+1];
			var b = pixelData[i*4+2];
			var a = pixelData[i*4+3];
			var grey = r*0.3+g*0.59+b*0.11;
			pixelData[i*4+0] = grey;
			pixelData[i*4+1] = grey;
			pixelData[i*4+2] = grey;
			// pixelData[i*4+3]
		}
	}
	function flurEffect(){
		var tempImageData = contexta.getImageData(0,0,canvasa.width,canvasa.height);
		var tempPixelData = imageData.data;
	}
	function reverse(pixelData){
		for(i = 0;i<canvasb.width*canvasb.height;i++){
			var r = pixelData[i*4+0];
			var g = pixelData[i*4+1];
			var b = pixelData[i*4+2];
			var a = pixelData[i*4+3];
			pixelData[i*4+0] = 255-r;
			pixelData[i*4+1] = 255-g;
			pixelData[i*4+2] = 255-a;
			// pixelData[i*4+3]
		}
	}
	function BlackOrWite(pixelData){
		for(i = 0;i<canvasb.width*canvasb.height;i++){
			var r = pixelData[i*4+0];
			var g = pixelData[i*4+1];
			var b = pixelData[i*4+2];
			var a = pixelData[i*4+3];
			var grey = r*0.3+g*0.59+b*0.11;
			var bow = 0;
			if (grey>255/2) {
				bow = 255;
			}else{
				bow = 0;
			};
			pixelData[i*4+0] = bow;
			pixelData[i*4+1] = bow;
			pixelData[i*4+2] = bow;
			// pixelData[i*4+3]
		}
	}
	function greyEffect2(pixelData){
		for(i = 0;i<canvasb.width*canvasb.height;i++){
			var r = pixelData[i*4+0];
			var g = pixelData[i*4+1];
			var b = pixelData[i*4+2];
			var a = pixelData[i*4+3];
			var grey = r*0.3+g*0.59+b*0.11;

			pixelData[i*4+0] += 100;
			pixelData[i*4+1] += 100;
			pixelData[i*4+2] += 50;
			// pixelData[i*4+3]
		}
	}
	</script>
</body>
</html>